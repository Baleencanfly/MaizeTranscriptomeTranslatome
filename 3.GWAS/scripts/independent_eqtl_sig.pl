#!/usr/bin/perl
use warnings;
use strict;

##LD##
#CHR_A         BP_A             SNP_A  CHR_B         BP_B             SNP_B           R2
#1        29400      chr1.s_29400      1        43293      chr1.s_43293     0.951024
#1        29400      chr1.s_29400      1        43706      chr1.s_43706     0.952826
#1        29400      chr1.s_29400      1       134779     chr1.s_134779     0.954483

##emmax##p from small to big##
#chr3:24609023-24678138  482     chr3    24609023        24678138        69115   chr3.s_24672196 1.489222379e-27 188     chr3    24676950        24676951        chr3.s_24676951 -0.5112080835   1.014069918e-13
#chr3:24609023-24678138  482     chr3    24609023        24678138        69115   chr3.s_24672196 1.489222379e-27 188     chr3    24676957        24676958        chr3.s_24676958 -0.5744991902   1.134417507e-16
#chr3:24609023-24678138  482     chr3    24609023        24678138        69115   chr3.s_24672196 1.489222379e-27 188     chr3    24677020        24677021        chr3.s_24677021 -0.7230413821   2.521911747e-23
#chr3:24609023-24678138  482     chr3    24609023        24678138        69115   chr3.s_24672196 1.489222379e-27 188     chr3    24677082        24677083        chr3.s_24677083 -0.5141300252   1.272127238e-13
#chr3:24609023-24678138  482     chr3    24609023        24678138        69115   chr3.s_24672196 1.489222379e-27 188     chr3    24677083        24677084        chr3.i_24677084 -0.5672697921   3.88618414e-15
#chr3:24609023-24678138  482     chr3    24609023        24678138        69115   chr3.s_24672196 1.489222379e-27 188     chr3    24678048        24678049        chr3.s_24678049 -0.4657095856   1.535856673e-12
#chr3:24609023-24678138  482     chr3    24609023        24678138        69115   chr3.s_24672196 1.489222379e-27 188     chr3    24678075        24678076        chr3.s_24678076 -0.4635532465   3.457337154e-12
#chr3:24609023-24678138  482     chr3    24609023        24678138        69115   chr3.s_24672196 1.489222379e-27 188     chr3    24678122        24678123        chr3.s_24678123 -0.4423097212   2.956081524e-11
#chr3:24609023-24678138  482     chr3    24609023        24678138        69115   chr3.s_24672196 1.489222379e-27 188     chr3    24678137        24678138        chr3.i_24678138 -0.5524704443   4.48443406e-16
#chr3:24730472-24767951  482     chr3    24730472        24767951        37479   chr3.s_24749759 1.216201295e-24 18      chr3    24730526        24730527        chr3.s_24730527 -0.7291014584   1.606874982e-24
#chr3:24730472-24767951  482     chr3    24730472        24767951        37479   chr3.s_24749759 1.216201295e-24 18      chr3    24730545        24730546        chr3.i_24730546 -0.5346328615   1.67653213e-15
#chr3:24730472-24767951  482     chr3    24730472        24767951        37479   chr3.s_24749759 1.216201295e-24 18      chr3    24730623        24730624        chr3.s_24730624 -0.5625303658   1.241433346e-16
#chr3:24730472-24767951  482     chr3    24730472        24767951        37479   chr3.s_24749759 1.216201295e-24 18      chr3    24730650        24730651        chr3.s_24730651 -0.510337063    1.478729425e-12
#chr3:24730472-24767951  482     chr3    24730472        24767951        37479   chr3.s_24749759 1.216201295e-24 18      chr3    24749423        24749424        chr3.s_24749424 -0.5592165694   1.568316983e-16
#chr3:24730472-24767951  482     chr3    24730472        24767951        37479   chr3.s_24749759 1.216201295e-24 18      chr3    24749621        24749622        chr3.i_24749622 -0.7315093007   2.068150613e-24

open LD , "<$ARGV[0]" || die;
open QTL , "<$ARGV[1]" || die;
open OUT , ">$ARGV[2]" || die;

my(%rsq,@region,$i,$j,$snp1,$snp2,$pheno);

readline LD;
while(<LD>){
	chomp;
	my ($snpa,$snpb) = (split /\t/,$_)[2,5];
	$rsq{"$snpa#$snpb"} = 1;
}

while(<QTL>){
	chomp;
	my @tmp = (split /\t/,$_)[6,0];
	push @region,[@tmp];
}

foreach $i(0..$#region-1){
	foreach $j($i+1..$#region){
		$snp1 = $region[$i][0];
		$snp2 = $region[$j][0];
		if ($region[$i][1] eq $region[$j][1]){
			next;
		}elsif ($region[$i][1] ne $region[$j][1]){
			$pheno = $region[$j][1];
			if (exists $rsq{"$snp1#$snp2"} || $rsq{"$snp2#$snp1"}){
				print OUT "$pheno\t$snp1\t$snp2\n";
			}
		}
	}
}

close LD;
close QTL;
close OUT;
